<!DOCTYPE html>
<html>
<head>
  <title>CueProjections - Control</title>
  <link rel="stylesheet" href="css/style.css">
  <script>
    let cues = [];
    let currentCue = 0;
    let inBlackout = false;
    let showName = localStorage.getItem("currentShow");

    function loadCues() {
      fetch(`assets/${showName}/`)
        .then(() => {
          cues = ["0", "1", "2", "3", "4"]; // Static cue names (image/video files)
          updatePreviews();
          displayCue();
        });
    }

    function getCueFile(index) {
      const cue = cues[index];
      if (!cue) return "";
      const base = `assets/${showName}/${cue}`;
      return [`${base}.png`, `${base}.jpg`, `${base}.jpeg`, `${base}.mp4`]
        .find(src => src.includes('.'));
    }

    function displayCue() {
      const viewer = window.open("", "viewerWindow");
      if (viewer) {
        viewer.postMessage({ cue: getCueFile(currentCue) }, "*");
      }

      document.getElementById("currentCue").textContent = `Cue ${currentCue}`;
      document.getElementById("currentTitle").textContent = getCueFile(currentCue);
      updatePreviews();
    }

    function goNext() {
      if (currentCue < cues.length - 1) currentCue++;
      inBlackout = false;
      displayCue();
    }

    function goBack() {
      if (currentCue > 0) currentCue--;
      inBlackout = false;
      displayCue();
    }

    function toggleBlackout() {
      inBlackout = !inBlackout;
      const viewer = window.open("", "viewerWindow");
      if (viewer) {
        viewer.postMessage({ blackout: inBlackout }, "*");
      }
      document.getElementById("blackoutBtn").textContent = inBlackout ? "Turn Off Blackout" : "Blackout";
    }

    function updatePreviews() {
      const prev = getCueFile(currentCue);
      const next = getCueFile(currentCue + 1);

      document.getElementById("previewCurrent").src = prev;
      document.getElementById("previewNext").src = next;
    }

    window.onload = () => {
      loadCues();
    };
  </script>
</head>
<body>
  <div class="main-container">
    <h1>Control Panel - <span id="currentCue"></span></h1>
    <p id="currentTitle"></p>
    <div class="preview-container">
      <img id="previewCurrent" alt="Current Preview">
      <img id="previewNext" alt="Next Preview">
    </div>
    <div class="button-group">
      <button onclick="goBack()">Back</button>
      <button onclick="goNext()">GO</button>
      <button id="blackoutBtn" onclick="toggleBlackout()">Blackout</button>
      <button onclick="location.href='home.html'">End Show</button>
    </div>
  </div>
</body>
</html>

