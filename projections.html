<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Projections Control</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .preview-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .preview-box {
      flex: 1;
      text-align: center;
      background: #333;
      padding: 10px;
      border-radius: 5px;
    }

    .preview-box img {
      max-height: 200px;
      max-width: 100%;
      object-fit: contain;
    }

    .button-group {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }

    #cueInfo {
      text-align: center;
      font-size: 1.2em;
      margin-bottom: 15px;
      color: white;
    }

    #showSelectModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #showSelectModal select, #showSelectModal button {
      width: 300px;
    }
  </style>
</head>
<body>
  <div class="main-container">
    <h1>Projections Control</h1>
    <div id="cueInfo">Loading show...</div>

    <div class="preview-container">
      <div class="preview-box">
        <h3>Current Cue</h3>
        <img id="currentPreview" src="" alt="Current Cue">
      </div>
      <div class="preview-box">
        <h3>Next Cue</h3>
        <img id="nextPreview" src="" alt="Next Cue">
      </div>
    </div>

    <div class="button-group">
      <button onclick="goBack()">‚¨ÖÔ∏è BACK</button>
      <button onclick="goCue()">‚ñ∂Ô∏è GO</button>
      <button onclick="toggleBlackout()" id="blackoutBtn">‚ö´ BLACKOUT</button>
      <button onclick="endShow()">‚õî END SHOW</button>
    </div>
  </div>

  <div id="showSelectModal">
    <div class="login-container">
      <h2>Select a Show</h2>
      <select id="showSelect"></select>
      <button onclick="loadShow()">Load Show</button>
    </div>
  </div>

  <script>
    let currentCue = 0;
    let showImages = [];
    let showName = '';
    let isBlackout = false;

    const showSelectModal = document.getElementById('showSelectModal');
    const showSelect = document.getElementById('showSelect');
    const currentPreview = document.getElementById('currentPreview');
    const nextPreview = document.getElementById('nextPreview');
    const cueInfo = document.getElementById('cueInfo');

    const userShows = JSON.parse(localStorage.getItem("assignedShows")) || [];

    // Load show options
    window.onload = () => {
      userShows.forEach(show => {
        const opt = document.createElement("option");
        opt.value = show;
        opt.textContent = show;
        showSelect.appendChild(opt);
      });
    };

    function loadShow() {
      showName = showSelect.value;
      fetchShowAssets(showName);
      showSelectModal.style.display = 'none';
    }

    function fetchShowAssets(showFolder) {
      // Dummy file list simulation (replace with dynamic fetching if needed)
      const assets = {
        RigCheck: ["1.png", "2.png", "3.png", "4.mp4"],
        Trashion: ["1.png", "2.png", "3.png"]
      };

      showImages = (assets[showFolder] || []).map(file => `assets/${showFolder}/${file}`);
      updatePreviews();
      sendToViewer();
    }

    function updatePreviews() {
      if (!showImages.length) return;

      const currentSrc = showImages[currentCue] || '';
      const nextSrc = showImages[currentCue + 1] || '';

      currentPreview.src = currentSrc;
      nextPreview.src = nextSrc;
      cueInfo.textContent = `Cue ${currentCue} ‚Äî ${extractTitle(currentSrc)}`;
    }

    function extractTitle(path) {
      return path.split('/').pop();
    }

    function goCue() {
      if (isBlackout) toggleBlackout();
      if (currentCue < showImages.length - 1) currentCue++;
      updatePreviews();
      sendToViewer();
    }

    function goBack() {
      if (isBlackout) toggleBlackout();
      if (currentCue > 0) currentCue--;
      updatePreviews();
      sendToViewer();
    }

    function toggleBlackout() {
      isBlackout = !isBlackout;
      const cue = isBlackout ? 'blackout' : showImages[currentCue];
      document.getElementById('blackoutBtn').textContent = isBlackout ? 'üîÜ TURN OFF BLACKOUT' : '‚ö´ BLACKOUT';
      localStorage.setItem("cue", cue);
    }

    function sendToViewer() {
      localStorage.setItem("cue", showImages[currentCue]);
    }

    function endShow() {
      window.location.href = "home.html";
    }
  </script>
</body>
</html>

