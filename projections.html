<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ProjectionsGo - Projections Control</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <h1>Projections Control Panel</h1>
  <div class="preview-area">
    <div>
      <h3>Current</h3>
      <video id="currentVideo" controls autoplay style="display:none;"></video>
      <img id="currentImage" />
      <p id="currentInfo"></p>
    </div>
    <div>
      <h3>Next</h3>
      <video id="nextVideo" controls style="display:none;"></video>
      <img id="nextImage" />
      <p id="nextInfo"></p>
    </div>
  </div>

  <div class="controls">
    <button onclick="go()">GO</button>
    <button onclick="back()">BACK</button>
    <button onclick="toggleBlackout()">BLACKOUT</button>
    <button onclick="endShow()">END SHOW</button>
  </div>

<script>
const query = new URLSearchParams(window.location.search);
const showName = query.get("show");

const shows = {
  "RigCheck": ["assets/RigCheck/1.png", "assets/RigCheck/2.png", "assets/RigCheck/3.png", "assets/RigCheck/4.mp4"],
  "Trashion": []
};

let cueIndex = 0;
let blackout = false;

const currentImage = document.getElementById("currentImage");
const currentVideo = document.getElementById("currentVideo");
const currentInfo = document.getElementById("currentInfo");

const nextImage = document.getElementById("nextImage");
const nextVideo = document.getElementById("nextVideo");
const nextInfo = document.getElementById("nextInfo");

function showCue(index) {
  const cue = shows[showName][index];
  if (!cue) return;

  const isVideo = cue.endsWith(".mp4");
  currentImage.style.display = isVideo ? "none" : "block";
  currentVideo.style.display = isVideo ? "block" : "none";

  if (isVideo) {
    currentVideo.src = cue;
    currentVideo.play();
  } else {
    currentImage.src = cue;
  }

  currentInfo.innerText = `Cue ${index + 1}`;

  const nextCue = shows[showName][index + 1];
  if (nextCue) {
    const isNextVideo = nextCue.endsWith(".mp4");
    nextImage.style.display = isNextVideo ? "none" : "block";
    nextVideo.style.display = isNextVideo ? "block" : "none";

    if (isNextVideo) {
      nextVideo.src = nextCue;
    } else {
      nextImage.src = nextCue;
    }
    nextInfo.innerText = `Cue ${index + 2}`;
  } else {
    nextImage.src = "";
    nextVideo.src = "";
    nextInfo.innerText = "";
  }
}

function go() {
  if (cueIndex < shows[showName].length - 1) {
    cueIndex++;
    showCue(cueIndex);
    updateViewer(cueIndex);
  }
}

function back() {
  if (cueIndex > 0) {
    cueIndex--;
    showCue(cueIndex);
    updateViewer(cueIndex);
  }
}

function toggleBlackout() {
  blackout = !blackout;
  document.body.style.backgroundColor = blackout ? "black" : "";
  if (!blackout) showCue(cueIndex);
}

function endShow() {
  window.location.href = "home.html";
}

function updateViewer(index) {
  const viewer = window.open('', 'viewerWindow');
  if (viewer) {
    viewer.postMessage({ cue: shows[showName][index] }, '*');
  }
}

window.onload = () => {
  showCue(0);
  updateViewer(0);
};
</script>
</body>
</html>

